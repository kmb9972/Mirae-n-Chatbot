"""
ë¯¸ë˜ì—” ì‚¬ë‚´ ë¹„ì„œ ì±—ë´‡ (Streamlit)
====================================
ì‹¤í–‰ ë°©ë²•:
  1. pip install streamlit anthropic
  2. streamlit run miraen_assistant.py
"""

import streamlit as st
import anthropic

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. ì§€ì‹ ë² ì´ìŠ¤ (Knowledge Base)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
KNOWLEDGE_BASE = """
[ë¯¸ë˜ì—” ì‚¬ë‚´ ë¹„ì„œ] í†µí•© ì§€ì‹ ë² ì´ìŠ¤

1. ìë…€ ì–‘ìœ¡ ë° êµìœ¡ ì§€ì› ê°€ì´ë“œ
ë¯¸ì·¨í•™ ìë…€ ë³´ìœ¡ë£Œ:
- 0ì„¸ë°˜: êµ­ê°€ 584,000ì› + íšŒì‚¬ 292,000ì› ì§€ì›.
- 1ì„¸ë°˜: êµ­ê°€ 515,000ì› + íšŒì‚¬ 257,500ì› ì§€ì›.
- 2ì„¸ë°˜: êµ­ê°€ 426,000ì› + íšŒì‚¬ 213,000ì› ì§€ì›.
- 3~5ì„¸ë°˜: êµ­ê°€ 280,000ì› + íšŒì‚¬ 140,000ì› ì§€ì›.

ë³´ìœ¡ì§€ì›ë¹„ ìˆ˜ë‹¹: ë§Œ 0~5ì„¸ ì›” 10ë§Œ ì›, ë§Œ 6ì„¸ ì›” 20ë§Œ ì› ê¸‰ì—¬ ì§€ê¸‰. ìë…€ ìƒì¼ ì›” ê¸°ì¤€ìœ¼ë¡œ ì§€ì›í•˜ë©° ë§¤ì›” 10ë§Œ ì›ê¹Œì§€ ë¹„ê³¼ì„¸ ì²˜ë¦¬.

ì·¨í•™ ìë…€ ì…í•™ ì„ ë¬¼: ì´ˆë“±í•™ìƒ 30ë§Œ ì›(í•™ìš©í’ˆ/ë„ì„œ), ì¤‘Â·ê³ ë“±í•™ìƒ 40ë§Œ ì›(êµë³µ/ì²´ìœ¡ë³µ) í•œë„ ë‚´ ì˜ìˆ˜ì¦ ì •ì‚°. ë§¤ë…„ 2ì›” ì‹ ì²­ì„œ ì ‘ìˆ˜.

ëŒ€í•™êµ í•™ìê¸ˆ: 5ë…„ ì´ìƒ ì¬ì§ì ìë…€ ëŒ€ìƒ ì—°ê°„ ìµœëŒ€ 200ë§Œ ì›. ì…í•™ê¸ˆ, ìˆ˜ì—…ë£Œ, ê¸°ì„±íšŒë¹„ë§Œ í•´ë‹¹. ë§¤ë…„ 8~9ì›” ì „ìê²°ì¬ ì‹ ì²­.

ìœ¡ì•„ê¸° ê·¼ë¡œì‹œê°„ ë‹¨ì¶•: ë§Œ 12ì„¸ ì´í•˜(ì´ˆ6 ì´í•˜) ìë…€ ëŒ€ìƒ ì¼ 1~5ì‹œê°„ ë‹¨ì¶• ê·¼ë¬´. ìœ¡ì•„íœ´ì§ ë¯¸ì‚¬ìš© ê¸°ê°„ì˜ 2ë°°ê¹Œì§€ ì—°ì¥ ì‚¬ìš© ê°€ëŠ¥.

2. ê²½ì¡°ì‚¬ ì§€ì›
ì£¼ìš” ê²½ì¡° ê¸°ì¤€:
- ë³¸ì¸ ê²°í˜¼: 30ë§Œ ì› / 7ì¼.
- ë³¸ì¸/ë°°ìš°ì ì¶œì‚°: 500ë§Œ ì› / 20ì¼ (120ì¼ ë‚´ 3íšŒ ë¶„í•  ê°€ëŠ¥, ì¶œì‚°ì¼ í¬í•¨ 3ì¼ ì—°ì† ì‚¬ìš© í•„ìˆ˜).
- ë¶€ëª¨ìƒ(ë°°ìš°ì ë¶€ëª¨ í¬í•¨): 30ë§Œ ì› / 5ì¼.
- ì¡°ë¶€ëª¨ìƒ(ì¹œ/ì™¸ê°€ í¬í•¨): 20ë§Œ ì› / 3ì¼ (ìŠ¹ì¤‘ ì‹œ 30ë§Œ ì› / 5ì¼).

ì¬ì§ ê¸°ê°„ ì°¨ë“±: ê·¼ì† 1ë…„ ë¯¸ë§Œì€ ê²½ì¡°ê¸ˆ 50% ì§€ê¸‰, íœ´ê°€ëŠ” ì „ì¼ ì§€ê¸‰.
ì‹ ì²­: ë°œìƒ 30ì¼ ì´ë‚´. ê·¸ë£¹ì›¨ì–´ 'ê²½ì¡°ì‚¬ ì‹ ê³ ì„œ' ì‘ì„± í›„ ì‹œí”„í‹°(Shiftee)ì— íœ´ê°€ ë³„ë„ ì…ë ¥ í•„ìˆ˜.
ì¥ë¡€ ì„œë¹„ìŠ¤: ë³¸ì¸/ë°°ìš°ì/ë¶€ëª¨/ìë…€ìƒ ì‹œ ì¥ë¡€ì§€ë„ì‚¬ 1ëª…(3ì¼), ì˜ì „ìš©í’ˆ(ìƒë³µ ë‚¨4Â·ì—¬4), ë¦¬ë¬´ì§„/ë²„ìŠ¤(200km) ì§€ì›.

3. íœ´ê°€ ë° ê·¼ë¬´ ì œë„
- ì—°ì°¨: 2ì‹œê°„ ë‹¨ìœ„(ì¿¼í„°) ë¶„í•  ì‚¬ìš© ê°€ëŠ¥.
- í”ŒëŸ¬ìŠ¤ íœ´ê°€: ì—°ì°¨ ì™¸ ë§¤ë…„ 4ì¼ ì¶”ê°€ ë¶€ì—¬. ë‹¹í•´ ì—°ë„ ì†Œë©¸, ì—°ì°¨ë³´ë‹¤ ìš°ì„  ì‚¬ìš© ê¶Œì¥.
- ì¥ê¸°ê·¼ì† íœ´ê°€: 5ë…„(3ì¼), 10/15ë…„(5ì¼), 20ë…„(7ì¼), 25/30/35ë…„(10ì¼).
- ì¬íƒê·¼ë¬´: ì£¼ 2íšŒ ì›ì¹™. ì£¼ì¤‘ íœ´ì¼ 1ì¼ ì‹œ ì¬íƒ 1ì¼, íœ´ì¼ 2ì¼ ì´ìƒ ì‹œ ì¬íƒ ë¶ˆê°€. ì‚¬ë¬´ì‹¤ ì „í™” íœ´ëŒ€í° ì°©ì‹  ì „í™˜ í•„ìˆ˜.
- ììœ¨ì¶œê·¼: ì¼ 9ì‹œê°„(íœ´ê²Œ í¬í•¨) ê·¼ë¬´ ì¤€ìˆ˜ í•˜ì— ì§€ê° ì—†ëŠ” ììœ¨ ì¶œê·¼.

4. ìê¸°ê³„ë°œ ë° IT ì„¤ì •
- ìê²©ì¦: LV 1~5ë“±ê¸‰ë³„ í•™ìŠµë¹„/ì¶•í•˜ê¸ˆ ì°¨ë“± ì§€ì›(ê° 20~150ë§Œ ì›). ë¦¬ìŠ¤íŠ¸ ì™¸ ìê²©ì¦ì€ ì§ë¬´ ì—°ê´€ì„± íŒë‹¨ í›„ ì§€ê¸‰.
- ì§ì›ìš© WIFI: MiraeN-AP / PW: 19480924ab
- ì™¸ë¶€ìš© WIFI: MiraeN-WIfI / PW: 34753800
- ë¬¸ì„œë³´ì•ˆ: ì„œë²„ doc.mirae-n.com, í¬íŠ¸ 443, ê³„ì •ì€ ì‚¬ë²ˆ.
- ëª…í•¨ ì‹ ì²­: mirae-n.onehp.co.kr / ID: miraen / PW: 1111

5. ì‚¬ë¬´ìœ„ì„ì „ê²°ê·œì • (ê²°ì¬ì„ )
íœ´ê°€/ê²½ì¡°ì‚¬ ì‹ ì²­:
- íŒ€ì› â†’ íŒ€ì¥ ì „ê²° (ì¸ì‚¬ì§€ì›íŒ€ í†µë³´). ì„œë¥˜: íœ´ê°€ì‹ ì²­ì„œ / ê²½ì¡°ì‚¬ì‹ ê³ ì„œ

ì‚¬ì™¸êµìœ¡:
- êµ­ë‚´ 3ì¼ ì´ë‚´: íŒ€ì¥(ì‹¤ì¥) ìŠ¹ì¸
- êµ­ë‚´ 3ì¼ ì´ˆê³¼: ë³¸ë¶€(ì‹¤)ì¥ ìŠ¹ì¸
- êµ­ë‚´ 1ê°œì›” ì´ìƒ: ì‚¬ì¥ ìŠ¹ì¸
- ì„œë¥˜: êµìœ¡ì‹ ì²­ì„œ

ë¹„ìš© ì „í‘œ(ê²½ë¹„):
- ê±´ë‹¹ 1ë°±ë§Œ ì› ë¯¸ë§Œ: íŒ€ì¥
- ê±´ë‹¹ 2ì²œë§Œ ì› ë¯¸ë§Œ: ë³¸ë¶€(ì‹¤)ì¥
- ê±´ë‹¹ 2ì²œë§Œ ì› ì´ìƒ: ì‚¬ì¥ ê²°ì¬

êµ¬ë§¤ í’ˆì˜(ë³¸ì‚¬):
- ì´ì•¡ 1ë°±ë§Œ ì› ë¯¸ë§Œ: íŒ€ì¥
- ì´ì•¡ 2ì²œë§Œ ì› ë¯¸ë§Œ: ë³¸ë¶€(ì‹¤)ì¥
- ì´ì•¡ 2ì²œë§Œ ì› ì´ìƒ: ë³¸ë¶€(ì‹¤)ì¥ â†’ ì‚¬ì¥

ì¶œì¥:
- êµ­ë‚´(íŒ€ì›): íŒ€ì¥ ìŠ¹ì¸ / ì„œë¥˜: ì¶œì¥ì‹ ì²­ì„œ
- êµ­ë‚´(íŒ€ì¥ ì´ìƒ): ë³¸ë¶€(ì‹¤)ì¥ ìŠ¹ì¸
- í•´ì™¸: ì‚¬ì¥ ìŠ¹ì¸, ê²½ì˜ê¸°íšì‹¤Â·ê²½ì˜ê´€ë¦¬íŒ€ í•©ì˜

ì ‘ëŒ€ë¹„:
- ê±´ë‹¹ 20ë§Œ ì› ë¯¸ë§Œ: íŒ€ì¥
- ê±´ë‹¹ 30ë§Œ ì› ë¯¸ë§Œ: ì‹¤ì¥
- ê±´ë‹¹ 30ë§Œ ì› ì´ìƒ: ë³¸ë¶€(ì‹¤)ì¥ (ì •ë„ê²½ì˜íŒ€ í•©ì˜)
"""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SYSTEM_PROMPT = f"""ë‹¹ì‹ ì€ ë¯¸ë˜ì—”(MiraeN) íšŒì‚¬ì˜ ì‚¬ë‚´ ë¹„ì„œì…ë‹ˆë‹¤.
ì§ì›ë“¤ì˜ ì¸ì‚¬, ë³µì§€, í–‰ì • ê´€ë ¨ ì§ˆë¬¸ì— ì•„ë˜ ì§€ì‹ ë² ì´ìŠ¤ë¥¼ ê·¼ê±°ë¡œ ì¹œì ˆí•˜ê³  ì •í™•í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”.

[ë‹µë³€ ì›ì¹™]
1. ì§€ì‹ ë² ì´ìŠ¤ì— ìˆëŠ” ë‚´ìš©ë§Œ ë‹µë³€í•˜ê³ , ì—†ëŠ” ë‚´ìš©ì€ "í•´ë‹¹ ë‚´ìš©ì€ ì§€ì‹ ë² ì´ìŠ¤ì— ì—†ì–´ ì¸ì‚¬ì§€ì›íŒ€ì— ë¬¸ì˜í•´ ì£¼ì„¸ìš”."ë¼ê³  ì•ˆë‚´í•˜ì„¸ìš”.
2. ê²°ì¬ ê´€ë ¨ ì§ˆë¬¸ì—ëŠ” ë°˜ë“œì‹œ ì „ê²°ê¶Œì, í•„ìš” ì„œë¥˜, ê´€ë ¨ ë¶€ì„œë¥¼ í•¨ê»˜ ì•ˆë‚´í•˜ì„¸ìš”.
3. ì‹ ì²­ ë°©ë²•ì´ ìˆì„ ê²½ìš° ê·¸ë£¹ì›¨ì–´ ë©”ë‰´ëª…ì´ë‚˜ ì‹œìŠ¤í…œ ê²½ë¡œë„ ì•ˆë‚´í•˜ì„¸ìš”.
4. ë‹µë³€ì€ í•œêµ­ì–´ë¡œ, ë”°ëœ»í•˜ê³  ì¹œê·¼í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
5. í•„ìš” ì‹œ bullet pointë‚˜ í‘œ í˜•ì‹ìœ¼ë¡œ ê°€ë…ì„± ìˆê²Œ ì •ë¦¬í•´ ì£¼ì„¸ìš”.

[ì§€ì‹ ë² ì´ìŠ¤]
{KNOWLEDGE_BASE}
"""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. í˜ì´ì§€ ì„¤ì • & ì»¤ìŠ¤í…€ CSS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(
    page_title="ë¯¸ë˜ì—” ì‚¬ë‚´ ë¹„ì„œ",
    page_icon="ğŸ¢",
    layout="wide",
    initial_sidebar_state="expanded",
)

st.markdown("""
<style>
    /* Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Pretendard:wght@400;600;700&display=swap');

    /* ì „ì²´ ë°°ê²½ */
    .stApp {
        background: #F4F6FB;
        font-family: 'Noto Sans KR', sans-serif;
    }

    /* ì‚¬ì´ë“œë°” */
    [data-testid="stSidebar"] {
        background: linear-gradient(160deg, #1A3A6B 0%, #0D2247 100%);
        border-right: none;
    }
    [data-testid="stSidebar"] * {
        color: #E8EEF8 !important;
    }

    /* ì‚¬ì´ë“œë°” ì¹´ë“œ */
    .sidebar-card {
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 12px;
        padding: 14px 16px;
        margin-bottom: 12px;
        backdrop-filter: blur(8px);
    }
    .sidebar-card h4 {
        color: #7FB3F5 !important;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin: 0 0 8px 0;
    }
    .sidebar-card p {
        font-size: 0.82rem;
        color: #C8D8F0 !important;
        margin: 4px 0;
        line-height: 1.5;
    }
    .sidebar-card .value {
        color: #FFFFFF !important;
        font-weight: 600;
        font-size: 0.88rem;
    }
    .sidebar-link {
        display: inline-block;
        background: rgba(127,179,245,0.2);
        color: #7FB3F5 !important;
        border: 1px solid rgba(127,179,245,0.4);
        border-radius: 8px;
        padding: 6px 12px;
        font-size: 0.8rem;
        font-weight: 600;
        text-decoration: none;
        margin-top: 4px;
        transition: all 0.2s;
    }
    .sidebar-link:hover {
        background: rgba(127,179,245,0.35);
    }

    /* ë©”ì¸ í—¤ë” */
    .main-header {
        background: linear-gradient(135deg, #1A3A6B 0%, #2A5298 100%);
        border-radius: 16px;
        padding: 28px 32px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 16px;
        box-shadow: 0 4px 24px rgba(26,58,107,0.18);
    }
    .main-header h1 {
        color: #FFFFFF !important;
        font-size: 1.6rem;
        font-weight: 700;
        margin: 0;
    }
    .main-header p {
        color: #A8C4E8 !important;
        font-size: 0.88rem;
        margin: 4px 0 0 0;
    }

    /* ë¹ ë¥¸ ì§ˆë¬¸ ë²„íŠ¼ */
    .quick-btn-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-bottom: 20px;
    }

    /* ì±„íŒ… ë©”ì‹œì§€ */
    .chat-msg-user {
        display: flex;
        justify-content: flex-end;
        margin: 8px 0;
    }
    .chat-msg-assistant {
        display: flex;
        justify-content: flex-start;
        margin: 8px 0;
    }
    .bubble-user {
        background: linear-gradient(135deg, #2A5298, #1A3A6B);
        color: #FFFFFF;
        border-radius: 18px 18px 4px 18px;
        padding: 12px 18px;
        max-width: 70%;
        font-size: 0.9rem;
        line-height: 1.6;
        box-shadow: 0 2px 12px rgba(26,58,107,0.2);
    }
    .bubble-assistant {
        background: #FFFFFF;
        color: #1A2B4A;
        border-radius: 18px 18px 18px 4px;
        padding: 12px 18px;
        max-width: 75%;
        font-size: 0.9rem;
        line-height: 1.7;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        border: 1px solid #E4EAF6;
    }
    .avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        flex-shrink: 0;
        margin: 0 8px;
    }
    .avatar-user { background: #2A5298; }
    .avatar-bot  { background: linear-gradient(135deg,#1A3A6B,#2A5298); }

    /* ì…ë ¥ì°½ */
    .stTextInput > div > div > input {
        border-radius: 24px !important;
        border: 2px solid #D0DCEF !important;
        padding: 12px 20px !important;
        font-size: 0.92rem !important;
        background: #FFFFFF !important;
        transition: border-color 0.2s;
    }
    .stTextInput > div > div > input:focus {
        border-color: #2A5298 !important;
        box-shadow: 0 0 0 3px rgba(42,82,152,0.1) !important;
    }

    /* ì „ì†¡ ë²„íŠ¼ */
    .stButton > button {
        border-radius: 24px !important;
        background: linear-gradient(135deg, #2A5298, #1A3A6B) !important;
        color: #FFFFFF !important;
        border: none !important;
        font-weight: 600 !important;
        font-size: 0.9rem !important;
        padding: 12px 28px !important;
        transition: all 0.2s !important;
        box-shadow: 0 3px 12px rgba(26,58,107,0.25) !important;
    }
    .stButton > button:hover {
        transform: translateY(-1px) !important;
        box-shadow: 0 5px 18px rgba(26,58,107,0.35) !important;
    }

    /* ë¹ ë¥¸ ì§ˆë¬¸ ë²„íŠ¼ */
    .quick-btn > button {
        background: #FFFFFF !important;
        color: #2A5298 !important;
        border: 1.5px solid #C0D0E8 !important;
        border-radius: 20px !important;
        font-size: 0.78rem !important;
        padding: 6px 12px !important;
        font-weight: 500 !important;
        width: 100% !important;
        box-shadow: 0 1px 4px rgba(0,0,0,0.06) !important;
    }
    .quick-btn > button:hover {
        background: #EEF3FC !important;
        border-color: #2A5298 !important;
    }

    /* êµ¬ë¶„ì„  */
    hr { border-color: rgba(255,255,255,0.1) !important; }

    /* ì±„íŒ… ì»¨í…Œì´ë„ˆ */
    .chat-container {
        background: #F9FAFF;
        border-radius: 16px;
        padding: 20px;
        border: 1px solid #E4EAF6;
        min-height: 420px;
        max-height: 520px;
        overflow-y: auto;
        margin-bottom: 16px;
    }

    /* ë¹ˆ ì±„íŒ… ì•ˆë‚´ */
    .empty-chat {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 300px;
        color: #8A9BBD;
    }
    .empty-chat .icon { font-size: 3rem; margin-bottom: 12px; }
    .empty-chat p { font-size: 0.9rem; text-align: center; line-height: 1.6; }

    /* ë¡œë”© */
    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 12px 18px;
        background: #FFFFFF;
        border-radius: 18px 18px 18px 4px;
        width: fit-content;
        border: 1px solid #E4EAF6;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .dot {
        width: 8px; height: 8px;
        background: #2A5298;
        border-radius: 50%;
        animation: bounce 1.2s infinite;
    }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce {
        0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
        40% { transform: scale(1); opacity: 1; }
    }

    /* ìˆ¨ê¸°ê¸° */
    #MainMenu, footer, header { visibility: hidden; }
    .block-container { padding-top: 1.5rem !important; }
</style>
""", unsafe_allow_html=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. ì‚¬ì´ë“œë°”
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.sidebar:
    # ë¡œê³ /íƒ€ì´í‹€
    st.markdown("""
        <div style="text-align:center; padding: 8px 0 20px;">
            <div style="font-size:2.4rem;">ğŸ¢</div>
            <div style="font-size:1.15rem; font-weight:700; color:#FFFFFF; margin-top:6px;">ë¯¸ë˜ì—” ì‚¬ë‚´ ë¹„ì„œ</div>
            <div style="font-size:0.75rem; color:#7FB3F5; margin-top:3px;">MiraeN Internal Assistant</div>
        </div>
    """, unsafe_allow_html=True)

    st.markdown("<hr>", unsafe_allow_html=True)

    # WIFI ì •ë³´
    st.markdown("""
        <div class="sidebar-card">
            <h4>ğŸ“¶ WIFI ì •ë³´</h4>
            <p>ì§ì›ìš©</p>
            <p class="value">MiraeN-AP</p>
            <p style="color:#7FB3F5 !important; font-size:0.75rem;">PW: 19480924ab</p>
            <p style="margin-top:10px;">ì™¸ë¶€ ë°©ë¬¸ê°ìš©</p>
            <p class="value">MiraeN-WIfI</p>
            <p style="color:#7FB3F5 !important; font-size:0.75rem;">PW: 34753800</p>
        </div>
    """, unsafe_allow_html=True)

    # ëª…í•¨ ì‹ ì²­
    st.markdown("""
        <div class="sidebar-card">
            <h4>ğŸªª ëª…í•¨ ì‹ ì²­</h4>
            <p>ì‚¬ì´íŠ¸ì— ì ‘ì†í•´ì„œ ì‹ ì²­í•˜ì„¸ìš”</p>
            <a class="sidebar-link" href="http://mirae-n.onehp.co.kr" target="_blank">
                ğŸ”— ëª…í•¨ ì‹ ì²­ ë°”ë¡œê°€ê¸°
            </a>
            <p style="margin-top:8px;">ID: <span class="value">miraen</span> &nbsp;|&nbsp; PW: <span class="value">1111</span></p>
        </div>
    """, unsafe_allow_html=True)

    # ë¬¸ì„œ ë³´ì•ˆ
    st.markdown("""
        <div class="sidebar-card">
            <h4>ğŸ”’ ë¬¸ì„œë³´ì•ˆ ì„¤ì •</h4>
            <p>ì„œë²„: <span class="value">doc.mirae-n.com</span></p>
            <p>í¬íŠ¸: <span class="value">443</span></p>
            <p>ê³„ì •: <span class="value">ì‚¬ë²ˆ</span></p>
        </div>
    """, unsafe_allow_html=True)

    # ê·¸ë£¹ì›¨ì–´ ë°”ë¡œê°€ê¸°
    st.markdown("""
        <div class="sidebar-card">
            <h4>ğŸ–¥ï¸ ê·¸ë£¹ì›¨ì–´</h4>
            <a class="sidebar-link" href="https://gw.mirae-n.com" target="_blank">
                ğŸ”— ê·¸ë£¹ì›¨ì–´ ì ‘ì†
            </a>
            <p style="margin-top:8px; font-size:0.75rem; color:#8AAAD0 !important;">
                ê²½ì¡°ì‚¬ ì‹ ê³ ì„œ Â· íœ´ê°€ì‹ ì²­ Â· ì „ìê²°ì¬
            </p>
        </div>
    """, unsafe_allow_html=True)

    # ì‹œí”„í‹° ë°”ë¡œê°€ê¸°
    st.markdown("""
        <div class="sidebar-card">
            <h4>ğŸ“… ê·¼íƒœ ê´€ë¦¬ (Shiftee)</h4>
            <a class="sidebar-link" href="https://www.shiftee.io" target="_blank">
                ğŸ”— ì‹œí”„í‹° ì ‘ì†
            </a>
            <p style="margin-top:8px; font-size:0.75rem; color:#8AAAD0 !important;">
                íœ´ê°€ ì…ë ¥ Â· ì—°ì¥ê·¼ë¬´ ì‹ ì²­
            </p>
        </div>
    """, unsafe_allow_html=True)

    st.markdown("<hr>", unsafe_allow_html=True)
    st.markdown("""
        <div style="text-align:center; font-size:0.72rem; color:#567AAA; padding: 4px 0;">
            ì¸ì‚¬ì§€ì›íŒ€ ë¬¸ì˜: ë‚´ì„  1234<br>
            Â© 2025 MiraeN Co., Ltd.
        </div>
    """, unsafe_allow_html=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5. ë©”ì¸ í™”ë©´
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í—¤ë”
st.markdown("""
    <div class="main-header">
        <div style="font-size:2.2rem;">ğŸ¤–</div>
        <div>
            <h1>ì•ˆë…•í•˜ì„¸ìš”, ë¯¸ë˜ì—” ì‚¬ë‚´ ë¹„ì„œì…ë‹ˆë‹¤ ğŸ‘‹</h1>
            <p>ì¸ì‚¬Â·ë³µì§€Â·í–‰ì • ê´€ë ¨ ê¶ê¸ˆí•œ ì ì„ í¸í•˜ê²Œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”. ì§€ì‹ ë² ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•˜ê²Œ ë‹µë³€ë“œë¦½ë‹ˆë‹¤.</p>
        </div>
    </div>
""", unsafe_allow_html=True)

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state.messages = []

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 6. ë¹ ë¥¸ ì§ˆë¬¸ ë²„íŠ¼
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
QUICK_QUESTIONS = [
    "ğŸ¼ ìœ¡ì•„íœ´ì§ ë° ë³´ìœ¡ë¹„ ì§€ì› ì•Œë ¤ì¤˜",
    "ğŸ’ ê²½ì¡°ì‚¬ íœ´ê°€ì¼ìˆ˜ì™€ ê²½ì¡°ê¸ˆ ê¸°ì¤€ì€?",
    "ğŸ–ï¸ í”ŒëŸ¬ìŠ¤ íœ´ê°€ê°€ ë­ì•¼?",
    "âœ… ì¶œì¥ ì‹ ì²­ ê²°ì¬ì„ ì´ ì–´ë–»ê²Œ ë¼?",
    "ğŸ“š ìê²©ì¦ ì·¨ë“ ì§€ì›ê¸ˆ ì–¼ë§ˆì•¼?",
    "ğŸ  ì¬íƒê·¼ë¬´ ê·œì • ì•Œë ¤ì¤˜",
]

st.markdown("<p style='font-size:0.82rem; color:#8A9BBD; margin-bottom:8px;'>ğŸ’¡ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</p>", unsafe_allow_html=True)

cols = st.columns(3)
for i, q in enumerate(QUICK_QUESTIONS):
    with cols[i % 3]:
        with st.container():
            st.markdown('<div class="quick-btn">', unsafe_allow_html=True)
            if st.button(q, key=f"quick_{i}"):
                st.session_state.messages.append({"role": "user", "content": q})
                st.session_state.pending_response = True
            st.markdown('</div>', unsafe_allow_html=True)

st.markdown("<br>", unsafe_allow_html=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 7. ì±„íŒ… ë©”ì‹œì§€ ë Œë”ë§
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
chat_area = st.container()

with chat_area:
    if not st.session_state.messages:
        st.markdown("""
            <div class="empty-chat">
                <div class="icon">ğŸ’¬</div>
                <p>ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ìœ„ ë¹ ë¥¸ ì§ˆë¬¸ì„ í´ë¦­í•˜ê±°ë‚˜,<br>ì•„ë˜ ì…ë ¥ì°½ì— ì§ˆë¬¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
            </div>
        """, unsafe_allow_html=True)
    else:
        for msg in st.session_state.messages:
            if msg["role"] == "user":
                st.markdown(f"""
                    <div class="chat-msg-user">
                        <div class="bubble-user">{msg["content"]}</div>
                        <div class="avatar avatar-user">ğŸ™‹</div>
                    </div>
                """, unsafe_allow_html=True)
            else:
                st.markdown(f"""
                    <div class="chat-msg-assistant">
                        <div class="avatar avatar-bot">ğŸ¤–</div>
                        <div class="bubble-assistant">{msg["content"]}</div>
                    </div>
                """, unsafe_allow_html=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 8. ì…ë ¥ì°½ + ì „ì†¡
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("<br>", unsafe_allow_html=True)
col_input, col_btn = st.columns([5, 1])

with col_input:
    user_input = st.text_input(
        label="ì§ˆë¬¸ ì…ë ¥",
        placeholder="ì˜ˆ: ì¶œì‚° íœ´ê°€ëŠ” ë©°ì¹  ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
        label_visibility="collapsed",
        key="user_input"
    )

with col_btn:
    send_clicked = st.button("ì „ì†¡ âœˆï¸", use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 9. API í˜¸ì¶œ ë° ì‘ë‹µ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def get_ai_response(messages_history: list) -> str:
    """Anthropic API í˜¸ì¶œ"""
    client = anthropic.Anthropic()  # ANTHROPIC_API_KEY í™˜ê²½ë³€ìˆ˜ ìë™ ì°¸ì¡°

    # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + ëŒ€í™” ì´ë ¥ ì „ë‹¬
    api_messages = [
        {"role": m["role"], "content": m["content"]}
        for m in messages_history
    ]

    response = client.messages.create(
        model="claude-sonnet-4-6",
        max_tokens=1500,
        system=SYSTEM_PROMPT,
        messages=api_messages,
    )
    return response.content[0].text


def handle_send(question: str):
    """ë©”ì‹œì§€ ì²˜ë¦¬ ê³µí†µ í•¨ìˆ˜"""
    question = question.strip()
    if not question:
        return

    # ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
    st.session_state.messages.append({"role": "user", "content": question})

    # ë¡œë”© í‘œì‹œ í›„ ì‘ë‹µ
    with st.spinner("ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."):
        try:
            answer = get_ai_response(st.session_state.messages)
        except Exception as e:
            answer = f"âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}\n\nANTHROPIC_API_KEY í™˜ê²½ë³€ìˆ˜ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”."

    st.session_state.messages.append({"role": "assistant", "content": answer})
    st.rerun()


# ì „ì†¡ ë²„íŠ¼ / ì—”í„°
if send_clicked and user_input:
    handle_send(user_input)
elif hasattr(st.session_state, "pending_response") and st.session_state.pending_response:
    st.session_state.pending_response = False
    # ë¹ ë¥¸ ì§ˆë¬¸ ì²˜ë¦¬: ë§ˆì§€ë§‰ user ë©”ì‹œì§€ì— ëŒ€í•œ ì‘ë‹µ
    last_user = st.session_state.messages[-1]["content"]
    with st.spinner("ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."):
        try:
            answer = get_ai_response(st.session_state.messages)
        except Exception as e:
            answer = f"âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"
    st.session_state.messages.append({"role": "assistant", "content": answer})
    st.rerun()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 10. ëŒ€í™” ì´ˆê¸°í™” ë²„íŠ¼
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if st.session_state.messages:
    st.markdown("<br>", unsafe_allow_html=True)
    col_clear = st.columns([4, 1])[1]
    with col_clear:
        if st.button("ğŸ—‘ï¸ ëŒ€í™” ì´ˆê¸°í™”", use_container_width=True):
            st.session_state.messages = []
            st.rerun()